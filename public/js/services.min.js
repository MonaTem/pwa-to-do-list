myApp.services={db:{setUp:function(e){window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;var o,n,t=window.indexedDB.open("newTodoList",1);t.onsuccess=function(e){o=t.result,console.log("successfully open the newTodoList from indexedDB!")},t.onerror=function(e){console.log("sth went wrong when opening indexedDB!")},t.onupgradeneeded=function(e){o=e.target.result,o.onerror=function(e){console.log("sth went wrong when opening indexedDB in onupgradeneeded!")},n=o.createObjectStore("toDoList",{keyPath:"key"}),console.log("nice, everything went well")}},saveListOfTodosToCache:function(e){var o=JSON.stringify(myApp.services.listOfTodos);window.indexedDB?myApp.services.db.checkIfTodoIsInCacheIfNotThenAdd(e):localStorage.listOfTodos=o},getListOfTodosFromCache:function(){if(!window.indexedDB)return localStorage.listOfTodos;var e=window.indexedDB.open("newTodoList",1);e.onsuccess=function(o){console.log("yo"),db=e.result;var n=db.transaction(["toDoList"],"readonly");n.oncomplete=function(){console.log("oncomplete from getListOfTodosFromCache")},n.onerror=function(){console.log("onerror from getListOfTodosFromCache")};var t=n.objectStore("toDoList");"getAll"in t?t.getAll().onsuccess=function(e){e.target.result.forEach(function(e){var o={key:e.key,description:e.description,createDate:e.createDate,flag:!1};myApp.services.todos.create(o)})}:t.openCursor().onsuccess=function(e){var o=e.target.result;if(o){var n={key:o.value.key,description:o.value.description,createDate:o.value.createDate,flag:!1};myApp.services.todos.create(n),o.continue()}}}},checkIfTodoIsInCacheIfNotThenAdd:function(e){var o=window.indexedDB.open("newTodoList",1);o.onsuccess=function(n){db=o.result;var t=db.transaction(["toDoList"],"readwrite");t.oncomplete=function(){console.log("oncomplete from checkIfTodoIsInCacheIfNotThenAdd")},t.onerror=function(){console.log("onerror from checkIfTodoIsInCacheIfNotThenAdd")};var c=t.objectStore("toDoList");c.get(e.key).onsuccess=function(o){var n=o.target.result;if(void 0===n)c.add(e).onsuccess=function(e){console.log("nice...from checkIfTodoIsInCacheIfNotThenAdd")};else if(n.description!=e.description){var t=c.put(e);t.onsuccess=function(){console.log("successfully updated the todo")}}else console.log("already in the cache, no need to add/update")}}},checkIfTodoIsInCacheIfTrueThenRemove:function(e){var o=window.indexedDB.open("newTodoList",1);o.onsuccess=function(n){db=o.result;var t=db.transaction(["toDoList"],"readwrite");t.oncomplete=function(){console.log("oncomplete from checkIfTodoIsInCacheIfTrueThenRemove")},t.onerror=function(){console.log("onerror from checkIfTodoIsInCacheIfTrueThenRemove")},t.objectStore("toDoList").delete(e).onsuccess=function(e){void 0===e.target.result&&(console.log("nice...from checkIfTodoIsInCacheIfTrueThenRemove"),location.reload())}}}},todos:{create:function(e){var o=e.key;if(null==o){var n=e.description+(new Date).getTime(),t=n.hashCode();o=t}var c=e.description,s=e.createDate,i=e.flag,d=document.createElement("div");d.classList.add("card"),d.classList.add("cardTemplate"),d.classList.add("weather-forecast");var r=document.createElement("div");r.classList.add("location");var a=document.createTextNode(c);r.appendChild(a),d.appendChild(r);var l=document.createElement("div");l.classList.add("date");var u=document.createTextNode(s);l.appendChild(u),d.appendChild(l);var f=document.createElement("div"),p=document.createElement("input");p.setAttribute("type","image"),p.setAttribute("id",o),p.onclick=function(){myApp.services.todos.remove(o)},p.setAttribute("src","images/Actions-edit-delete-icon.png"),p.setAttribute("alt","A delete icon by Oxygen Team"),f.appendChild(p),d.appendChild(f);var m=document.getElementById("main");document.querySelector(".main").insertBefore(d,m.childNodes[0]),i&&document.querySelector("#myNavigator").popPage();var v={key:o,description:c,createDate:s};myApp.services.listOfTodos.push(v),myApp.services.db.saveListOfTodosToCache(v)},remove:function(e){myApp.services.arrayOperation.remove(e)}},arrayOperation:{remove:function(e){var o,n,t=myApp.services.listOfTodos;Object.keys(t).forEach(function(o){t[o].key==e&&(n=o)}),o=t[n],t.splice(n,1),myApp.services.listOfTodos=t,myApp.services.db.checkIfTodoIsInCacheIfTrueThenRemove(o.key)}},listOfTodos:[]};